---
layout: e0
permalink: nft
BeiJing: 0／0-01.png
BeiJing_SJ: 0／0-01.png
BiaoTi: 那幅图
div0: 1
---
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>

<style>
    sup[S]:before{content:" S";color:#ffc800;font-weight:bold}sup[A]:before{content:" A";color:#d229db}sup[B]:before{content:" B";color:#2977DB}sup[C]:before{content:" C";color:#1456ad}sup[EX]:before{content:" EX";color:#1ff434}
</style>

<div id="房子"></div>
<div id="元素"></div>

<div id="下载" style="display:none;"></div>

<a onclick="saveCertificateBook(1)">保存图片</a><br>

<script>

let w={
    "ceshi":"#房子{width:400px;height:400px}#房子 img{width:400px;height:400px;position:absolute;top:0;left:0}#点点{position:relative;width:160px;height:160px;top:160px;left:120px}",
}


try{
    let q="/i/w/那幅图/";
    let 地址=q+"0/"+location.href.split("?")[1]+".json";
    let GetJson=$.ajax({
        url:地址,
        type:"GET",
        dataType:"json",
        async:false,
        success:function(data){
        }
    });
    地址=GetJson.responseJSON;

    console.log(1,地址)

    q=q+地址["w"]+"/";

    let dy1="<style>"+w[地址["w"]]+"</style>";
    let dy2="";
    for(let i=0;地址["q"].length>i;i++){
        dy1+="<img src='"+q+地址["q"][i][0]+"."+地址["q"][i][1]+"'>";
        dy2+=地址["q"][i][0]+"<sup "+地址["q"][i][2]+"></sup>"+"　";
    }
    dy1+="<div id='点点' style='background-color:#"+地址["x"]+"'></div>"
    for(let i=0;地址["e"].length>i;i++){
        dy1+="<img src='"+q+地址["e"][i][0]+"."+地址["e"][i][1]+"'>";
        dy2+=地址["e"][i][0]+"<sup "+地址["e"][i][2]+"></sup>"+"　";
    }
    document.getElementById("房子").innerHTML=dy1;
    document.getElementById("元素").innerHTML="<b><small>像素点编号：</small></b><a href='/"+地址["x"]+"'>"+地址["x"]+"</a><br><b><small>元素：</small></b>"+dy2;

    }catch(e){
    notyf.alert("失败，代码有误或网络故障");
}

function saveCertificateBook(o){

html2canvas(document.querySelector("#htmlElement")).then(canvas => {
    document.getElementById("下载").innerHTML=canvas;
});

var date = new Date();
const canvasID = document.getElementById("下载");
const rect=document.getElementById("下载").getBoundingClientRect()
// 生成图片并上传到数据库保存
html2canvas(canvasID, {
scale: o, // 数值越大生成的图片越清晰
useCORS: true,
allowTaint: true,
y: 0, // 滚动条高度修复
x: 0,
allowTaint: true, //开启跨域
useCORS: true,
scrollX: 0,
scrollY: rect.top, // 关键代码
height: rect.height, // 加高度，避免截取不全
}).then((canvas) => {
        let dataURL = canvas.toDataURL("image/png"); // 拿到数据流     
        var aLink = document.createElement("a"); // 创建一个a标签
        var blob = base64ToBlob(dataURL);
        var event = document.createEvent("HTMLEvents");
        event.initEvent("click", true, true);
        aLink.download = date.getTime() + "." + blob.type.split("/")[1]; // 使用时间戳给文件命名
        aLink.href = URL.createObjectURL(blob);
        aLink.click();
})
}

// base64转Blob对象
function   base64ToBlob(code) {
    var parts = code.split(";base64,");
    var contentType = parts[0].split(":")[1];
    var raw = window.atob(parts[1]);
    var rawLength = raw.length;
    var uint8Array = new Uint8Array(rawLength);
    for (var i = 0; i < rawLength; i++) {
        uint8Array[i] = raw.charCodeAt(i);
    }
    return new Blob([uint8Array], {type: contentType});
}

</script>


